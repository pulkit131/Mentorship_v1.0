<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Razorpay Test Payment</title>
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>
  <h2>Subscribe to Course</h2>
  <button onclick="payNow(599)">Subscribe for ₹599</button>
  <button onclick="payNow(799)">Subscribe for ₹799</button>

  <script>
    async function payNow(amount) {
      
      const res = await fetch('http://localhost:5000/create-order', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ amount })
      });
      const data = await res.json();
      if (!data.orderId) {
        alert('Failed to create order');
        return;
      }

     
      const options = {
        key: data.key,
        amount: data.amount,
        currency: data.currency,
        name: "Course Subscription",
        description: `Subscribe for ₹${amount}`,
        order_id: data.orderId,
        handler: async function (response) {
          // Verify payment on backend
          const verifyRes = await fetch('http://localhost:5000/verify-payment', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              razorpay_order_id: response.razorpay_order_id,
              razorpay_payment_id: response.razorpay_payment_id,
              razorpay_signature: response.razorpay_signature
            })
          });
          const verifyData = await verifyRes.json();
          if (verifyData.success) {
            alert('Payment successful and verified!');
          } else {
            alert('Payment verification failed!');
          }
        },
        theme: { color: "#3399cc" }
      };
      const rzp = new Razorpay(options);
      rzp.open();
    }
  </script>
</body>
</html>